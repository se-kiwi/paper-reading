# Memory

Memory一般包括易失性储存器（Volatile Memory）和非易失性储存器（Non-volatile Memory），但后者一般属于Storage的范畴，故本节主要讨论易失性储存器。易失性储存器，也就是我们一般所说的随机存取存储器（RAM, Random Access Memory）分为两类：动态随机存取储存器（DRAM）和静态随机存取储存器（SRAM）。其中SRAM速度很快，但造价高，一般用于缓存，本节主要介绍DRAM。

## 演化史

### 异步DRAM

异步DRAM是最早的DRAM，异步指的是内存的时钟频率和CPU的时钟频率不一致。异步DRAM都采用SIMM(Single In-line Memory Modules)，这种模组通常拥有72个引脚，而且仅支持32位数据。上述的种种限制决定了DRAM必将被更先进的DRAM取代。

### (SDR) SDRAM

SDRAM中的S代表同步（Synchronous）。在同步DRAM的设计中引入了一条时钟线，所有的信号都在时钟的上升沿被捕获，这使得内存的时钟频率和CPU的时钟频率保持一致，大大提高了其数据传输效率。

此时的内存模组也由SIMM进化到了DIMM(Dual In-line Memory Modules)，这种模组包含168个引脚，支持64位数据的传输。这和CPU总线一致，只需一根内存就能够正常工作，相比之下，要使用异步DRAM必须使用两条。

SDRAM的容量较异步DRAM也有较大提升，一般为16MB到512MB。

### DDR SDRAM

上文中的SDR指的是Sing Data Rate，这里介绍的DDR(Dual Data Rate)就是其升级版。DDR可以在时钟的上升沿和下降沿各传输一次信号，这就使得它的数据传输速率是SDR的两倍。它对DIMM也做了升级，包含184个引脚。其容量也有显著提升，一般为128MB到1GB。

### DDR2

DDR2是DDR的升级版本，它和DDR的主要区别是：DDR2内存单元的核心频率是等效频率的1/4。这需要一个4-bit-deep的预取队列，在并不用改变内存单元本身的情况下，DDR2能有效地达到DDR数据传输速度的两倍，此外DDR2融入了CAS、OCD、ODT技术规范和中断指令，运行效率更高。

DDR2的引脚数目增加到240个，其标准电压也由DDR的2.5V下降到1.8V，更加节能。其容量较DDR也翻了一倍，一般为256MB到2GB。

### DDR3

和上一代的DDR2相比，DDR3在许多方面作了新的规范，预取从4-bit变成了8-bit，这也是DDR3提升带宽的关键，同样的核心频率DDR3能够提供两倍于DDR2的带宽，此外DDR3还新增了CWD、Reset、ZQ、STR、RASR等技术。

DDR3的引脚数目较DDR2比没有变化，仍是240个，但其标准电压由1.8V降到了1.5V。其容量也增大到512MB~8GB。

### DDR4

从DDR1到DDR3，每一代DDR技术的内存预取位数都会翻倍，前三者分别是2bit、4bit及8bit，以此达到内存带宽翻倍的目标，不过DDR4在预取位上保持了DDR3的8bit设计，因为继续翻倍为16bit预取的难度太大，DDR4转而提升Bank数量，它使用的是Bank Group（BG）设计，4个Bank作为一个BG组，可自由使用2-4组BG，每个BG都可以独立操作。使用2组BG的话，每次操作的数据就是16bit，4组BG则能达到32bit操作，这其实变相提高了预
取位宽。

DDR4的引脚数目提高到了288个，其标准电压降到了1.2V。单条容量一般为4GB, 8GB, 16GB。

### 总结对照表

| SDRAM标准 | 总线时钟(MHz) | 内频(MHz) | 预取 | 传输速率(GB/s) | 电压(V) | 引脚数 |
| :-------: | :-----------: | :-------: | :--: | :------------: | :-----: | :----: |
|  **SDR**  |    100-166    |  100-166  |  1n  |    0.8-1.3     |   3.3   |  168   |
|  **DDR**  |    100-200    |  100-200  |  2n  |    2.1-3.2     |   2.5   |  184   |
| **DDR2**  |    200-533    |  100-266  |  4n  |    4.2-6.4     |   1.8   |  240   |
| **DDR3**  |   400-1066    |  100-266  |  8n  |    8.5-14.9    |   1.5   |  240   |
| **DDR4**  |   800-1200    |  200-300  |  8n  |    17-21.8     |   1.2   |  288   |

## 性能评估

### 评估参数

- **系统时钟循环周期**：表示SDRAM能运行的最大频率

  > 例如：一块系统时钟频率为10ns的SDRAM的芯片，他可以运行在100MHz的频率下。显然，这个数字越小，SDRAM芯片所能运行的频率就越高。

- **存取时间**：代表读取数据所延迟的时间

  > 大多数SDRAM芯片的存取时间为6，7，8或10ns。

- **内存延时**：系统进入数据存取操作就绪状态前等待内存响应的时间

  > 例如：某些SDRAM能够运行在CL2或3模式。也就是说他们读取数据所延迟的时间既可以是二个时钟周期也可以是三个时钟周期。

### 参数关系

- **系统时钟循环周期**是和外部设备息息相关的一个参数，它决定了能跑在什么样的CPU上。一般情况下，这个循环周期越小越好，这样就能支持更高频率的外部设备。然而如果其最大频率超过了外部设备的最大频率，会造成资源的浪费。
- **内存延时**一般是**系统时钟循环周期**的整数倍，这个倍数越小越好。
- **存取时间**和**内存延时**相互制约，也就是说，当获取了更高的**存取时间**，就增加了一部分的**内存延时**。

### 补充说明

上述参数说的是**内存芯片**的参数，当前制造内存芯片的厂商主要有三家：Micron，Samsung和Hynix。市场上常见的Kingston并不制造内存芯片，而是负责将内存芯片封装成**内存条**。内存条的参数和内存芯片的参数有少许不同，比如增加了**内存容量**这一参数。

## 其它Memory

### 服务器内存

服务器内存更看重的是所应用的技术，大部分先进的技术都用在了服务器内存上，而大部分先进的工艺都用在了普通内存上。比如服务器内存通常都有ECC技术，chipkill、热插拔等技术，而普通内存只有少数拥有ECC技术，UDIMM ECC就是这种内存，普通PC也能用，只不过无法开启ECC功能。

ECC技术的主要作用是用于数据纠错，毕竟服务器内存通常都是长时间工作负载，连续通电工作一个月都是很正常的时，为了保证运行的稳定必须要对内存里的数据进行纠错，才能确保计算机指令的正确传达和执行。不像普通内存通常只需要持续工作几小时或十几小时就行。另外热插拔技术也是保证服务器持续稳定运行的一个重要技术，使维护人员可以在服务器正常带电运行的情况下，直接对内存进行插拔操作，普通的内存条则不具备这样的技术，想要对PC的内存进行更换等操作都需要关机断电才行。可以说服务器上的内存、硬盘等硬件都具有热插拔技术。

### SRAM

SRAM（Static Random-Access Memory）是随机存取存储器的一种。所谓的“静态”，是指这种存储器只要保持通电，里面储存的数据就可以恒常保持。相比之下，动态随机存取存储器（DRAM）里面所储存的数据就需要周期性地更新。它仍然属于RAM，也就是当电力供应停止时，其中储存的数据还是会消失。

SRAM的传输速率比DRAM要快得多，当然也更加昂贵。SRAM的内部结构十分复杂，比同样容量的DRAM占用空间要大得多，因此目前并不适用于像PC内存这样较高储存密度低成本的场景。但不可否认的是，发展SRAM技术也是今后RAM发展的一个方向。

## 小结

从DRAM的发展史来看，每隔几年就会有新一代的技术出来，但更新速度在放缓：2002年产出DDR，2004年产出DDR2，2007年产出DDR3，直到2014年才产出DDR4。而且其核心技术并没有颠覆性的改变，前三代都是在将内存预取位数翻倍，到第四代时，预取位数也到了瓶颈，只能通过Bank Group的方法变相提高预取位数。目前各个厂商在积极推进DDR5的发展，从三星的数据来看，要在DDR5中将预取位数提高到16位。可以预见，这条优化的道路并不足以让DRAM的传输速率一直翻倍下去，业界的相关研究人员也不会停止研究代替DRAM的新技术的脚步。

## 参考文献

- \[1\] 蓝色. 内存技术进化一览[J].  技术应用. 2017(4)
- \[2\] [SDRAM,DDR3,DDR2,DDR4,DDR1的区别对比及其特点分析](http://www.elecfans.com/bandaoti/cunchu/20171117581277.html)
- \[3\] [The truth about memory manufacturers](http://www.crucial.com/usa/en/store-truth-about-memory-manufacturers)
- \[4\] [Random-access memory](https://en.wikipedia.org/wiki/Random-access_memory)
- \[5\] [内存参数](https://baike.baidu.com/item/%E5%86%85%E5%AD%98%E5%8F%82%E6%95%B0/3386551?fr=aladdin)
- \[6\] [Static random-access memory](https://en.wikipedia.org/wiki/Static_random-access_memory)